<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#4c0519">
    <title>Connection Lab ‚ù§Ô∏è</title>
    
    <!-- Premium Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@300;500;700&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            /* ROMANTIC THEME PALETTE */
            --primary: #e11d48;    /* Rose Red */
            --secondary: #fb7185;  /* Soft Pink */
            --success: #10b981;    /* Green for success */
            --danger: #ef4444;     /* Red for danger */
            --bg-dark: #4c0519;    /* Deep Wine */
            
            --glass-surface: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.7);
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        
        body {
            margin: 0;
            font-family: 'Outfit', 'Noto Sans Ethiopic', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
            overflow-x: hidden;
        }

        /* --- Animated Romantic Background --- */
        .ambient-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            /* Deep Red, Wine, and Rose Gradient */
            background: linear-gradient(135deg, #2e020e, #4c0519, #881337, #be123c);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Header Section --- */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(46, 2, 14, 0.85); /* Dark Wine Glass */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 15px 24px;
            padding-top: max(15px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .brand {
            font-size: 1.2rem;
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* --- LOGO STYLES --- */
        .logo-placeholder {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            box-shadow: 0 4px 15px rgba(225, 29, 72, 0.5);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .progress-pill {
            background: rgba(255,255,255,0.1);
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- Controls Area --- */
        .controls-area {
            padding: 25px 20px;
            text-align: center;
        }

        /* PREMIUM SPIN BUTTON (Red Theme) */
        .btn-spin {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(225, 29, 72, 0.5);
            display: inline-flex;
            align-items: center;
            gap: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            max-width: 320px;
            justify-content: center;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }

        .btn-spin:active { transform: scale(0.96); }
        
        /* Continuous Shine Animation */
        .btn-spin::after {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.4), transparent);
            transform: skewX(-20deg);
            animation: shine 4s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            20% { left: 200%; }
            100% { left: 200%; }
        }

        .btn-spin i { transition: transform 0.5s; }
        .btn-spin.spinning i { animation: spinIcon 0.8s linear infinite; }

        @keyframes spinIcon { 100% { transform: rotate(360deg); } }

        /* --- Main Grid --- */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px 60px 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 40px;
        }

        .card {
            aspect-ratio: 1;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            
            /* Initial state for entrance animation */
            opacity: 0;
            transform: translateY(20px);
            animation: cardEntrance 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes cardEntrance {
            to { opacity: 1; transform: translateY(0); }
        }

        .card:active { transform: scale(0.9) !important; }

        .card.highlight {
            background: white;
            color: var(--primary);
            box-shadow: 0 0 25px rgba(251, 113, 133, 0.6); /* Pink Glow */
            transform: scale(1.15);
            z-index: 10;
            border-color: white;
        }

        .card.used {
            background: rgba(0,0,0,0.25);
            border-color: transparent;
            color: rgba(255,255,255,0.2);
            box-shadow: none;
        }

        /* --- Functional Reset Button --- */
        .btn-reset {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-muted);
            border: 1px solid var(--glass-border);
            padding: 18px;
            width: 100%;
            border-radius: 18px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        .btn-reset:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Danger state */
        .btn-reset.confirming {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
            animation: shake 0.4s ease-in-out;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* --- Bottom Sheet Modal --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .sheet {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            /* Romantic Modal Gradient */
            background: linear-gradient(to bottom, #4c0519, #2e020e);
            border-top: 1px solid rgba(255,255,255,0.2);
            border-radius: 30px 30px 0 0;
            padding: 30px 24px;
            padding-bottom: max(30px, env(safe-area-inset-bottom));
            transform: translateY(110%);
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 101;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 -10px 50px rgba(0,0,0,0.5);
        }

        .modal-overlay.active .sheet { transform: translateY(0); }

        .category-badge {
            display: inline-block;
            background: rgba(251, 113, 133, 0.15); /* Soft Pink Badge */
            color: #fca5a5;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            padding: 8px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(251, 113, 133, 0.3);
        }

        .q-text {
            font-size: 1.5rem;
            line-height: 1.5;
            font-weight: 600;
            color: white;
            margin-bottom: 40px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 18px;
            width: 100%;
            border-radius: 18px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(225, 29, 72, 0.3);
        }
        
        .btn-close-text {
            background: transparent;
            border: none;
            color: var(--text-muted);
            margin-top: 15px;
            width: 100%;
            padding: 10px;
            font-size: 0.95rem;
            cursor: pointer;
        }

        /* --- Confetti Animation --- */
        .confetti {
            position: fixed;
            width: 8px; height: 8px;
            top: -10px;
            z-index: 200;
            pointer-events: none;
            animation: fall linear forwards;
        }
        
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

    </style>
</head>
<body>

    <div class="ambient-bg"></div>

    <!-- Header -->
    <header class="app-header">
        <div class="brand">
            <div class="logo-placeholder">
                <i class="fa-solid fa-heart"></i>
            </div>
            <span>Connection Lab</span>
        </div>
        <div class="progress-pill">
            <span id="progressText">0/40</span>
        </div>
    </header>

    <!-- Controls -->
    <div class="controls-area">
        <button class="btn-spin" id="spinBtn">
            <i class="fa-solid fa-arrows-rotate"></i> Spin Random
        </button>
    </div>

    <!-- Main Grid -->
    <div class="container">
        <div class="grid" id="grid"></div>
        
        <!-- Smart Reset Button -->
        <button id="resetBtn" class="btn-reset">
            <i class="fa-solid fa-rotate-right"></i> Start Over
        </button>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="overlay">
        <div class="sheet">
            <div style="text-align: center;">
                <div style="font-size: 0.9rem; color: #fda4af; margin-bottom: 12px; font-weight: 600; letter-spacing: 1px;" id="mNumber">#</div>
                <div class="category-badge" id="mCategory">Topic</div>
                <div class="q-text" id="mText">...</div>
            </div>
            <button class="btn-primary" id="doneBtn">
                <i class="fa-solid fa-check"></i> Mark as Done
            </button>
            <button class="btn-close-text" id="closeBtn">Close</button>
        </div>
    </div>

    <script>
        /* ================= STATE ENGINE ================= */
        const appState = {
            usedIds: JSON.parse(localStorage.getItem('dash_used_v3')) || [],
            currentId: null,
            isSpinning: false,
            total: 40
        };

        /* ================= CATEGORY COLORS (For dynamic badge) ================= */
        const categoryColors = {
            "Personality": "#fb7185",
            "Love": "#f43f5e",
            "Depth": "#e11d48",
            "Future": "#be123c",
            "Money": "#10b981",
            "Values": "#6366f1",
            "Fun": "#f59e0b",
            "Intimacy": "#ec4899"
        };

        /* ================= DATABASE (Gender Neutral) ================= */
        const db = [
            { id: 1, cat: "Personality", q: "·â†·àÖ·ã≠·ãà·âµ·àÖ/·àΩ ·â†·å£·àù ·ã∞·àµ·â∞·äõ ·ã®·àö·ã´·ã∞·à≠·åç·àÖ/·àΩ ·äê·åà·à≠ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 2, cat: "Personality", q: "·â†·à´·àµ·àÖ/·àΩ ·â†·å£·àù ·ã®·àù·âµ·äÆ·à´·â†·âµ/·à™·â†·âµ ·äê·åà·à≠ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 3, cat: "Personality", q: "·à∞·ãé·âΩ ·àµ·àà ·ä†·äï·â∞/·â∫ ·ä†·â•·ãõ·äõ·ãç ·åä·ãú ·â†·â∞·à≥·à≥·â∞ ·àò·äï·åà·ãµ ·ã®·àö·à®·ã±·âµ ·äê·åà·à≠ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 4, cat: "Personality", q: "·àÖ·ã≠·ãà·âµ ·çà·â≥·äù ·â†·àö·àÜ·äï·â†·âµ ·åä·ãú ·ãà·ã∞·çä·âµ ·ä•·äï·ãµ·âµ·âÄ·å•·àç/·ã≠ ·ã®·àö·ã´·â†·à®·â≥·â≥·àÖ/·àΩ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 5, cat: "Personality", q: "·ãç·à≥·äî ·ä†·à∞·å£·å•·àÖ/·àΩ ·ä•·äï·ã¥·âµ ·äê·ãç? ·â†·àµ·àú·âµ ·ãà·ã≠·àµ ·â†·àù·ä≠·äï·ã´·âµ?" },
            { id: 6, cat: "Love", q: "·å§·äì·àõ ·åç·äï·äô·äê·âµ ·â†·ä†·äï·â∞/·â∫ ·ä•·ã≠·â≥ ·àù·äï ·ã≠·àò·àµ·àã·àç?" },
            { id: 7, cat: "Love", q: "·â†·å£·àù ·ä•·äï·ã∞·â∞·ãà·ã∞·ãµ·ä≠/·àΩ ·ã®·àö·à∞·àõ·àÖ/·àΩ ·â†·àù·äï ·ä†·ã≠·äê·âµ ·àÅ·äî·â≥ ·äê·ãç?" },
            { id: 8, cat: "Love", q: "·â†·ä†·äï·ãµ ·åç·äï·äô·äê·âµ ·ãç·àµ·å• ·â†·çç·åπ·àù ·ã®·àõ·ã≠·â≥·àà·çç ·äê·åà·à≠ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 9, cat: "Love", q: "·ä†·àà·àò·åç·â£·â£·â∂·âΩ ·à≤·çà·å†·à© ·ä†·â•·ãõ·äõ·ãç·äï ·åä·ãú ·ä•·äï·ã¥·âµ ·äê·ãç ·ã®·àù·â≥·àµ·â∞·äì·åç·ã∞·ãç/·åÇ·ãç?" },
            { id: 10, cat: "Love", q: "·çç·âÖ·à≠ ·â†·åä·ãú ·àÇ·ã∞·âµ ·ä•·ã´·ã∞·åà ·ã®·àö·àò·å£ ·ã≠·àò·àµ·àç·àÉ·àç/·àª·àç ·ãà·ã≠·àµ ·â†·ä†·äï·ã¥ ·ã®·àö·çà·å†·à≠?" },
            { id: 11, cat: "Depth", q: "·àÖ·ã≠·ãà·âµ ·â†·ä†·àµ·â∏·åã·à™ ·àò·äï·åà·ãµ ·ã´·àµ·â∞·àõ·à®·àÖ/·àΩ ·âµ·àç·âÅ ·âµ·àù·àÖ·à≠·âµ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 12, cat: "Depth", q: "·à≤·å®·äï·âÖ·àÖ/·àΩ ·à´·àµ·àÖ·äï/·àΩ·äï ·àà·àõ·à®·åã·åã·âµ ·àù·äï ·â≥·ã∞·à≠·åã·àà·àÖ/·ã´·àà·àΩ?" },
            { id: 13, cat: "Depth", q: "·ä†·äï·ãµ ·à∞·ãç ·â†·àµ·àú·âµ·àÖ/·àΩ ·àã·ã≠ ·åâ·ã≥·âµ ·â¢·ã´·ã∞·à≠·àµ·â•·àÖ/·àΩ ·àù·àã·àΩ·àÖ/·àΩ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 14, cat: "Depth", q: "·â†·âÄ·àã·àâ ·ã≠·âÖ·à≠ ·âµ·àã·àà·àÖ/·ã´·àà·àΩ ·ãà·ã≠·àµ ·åä·ãú ·ã´·àµ·çà·àç·åç·àÉ·àç/·àª·àç?" },
            { id: 15, cat: "Depth", q: "·â†·âµ·àç·âÖ·äê·âµ ·ã®·àù·âµ·çà·à´·ãç/·à™·ãç ·ã®·àµ·àú·âµ ·àµ·åã·âµ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 16, cat: "Future", q: "·â†5-10 ·ãì·àò·â≥·âµ ·ãç·àµ·å• ·à´·àµ·àÖ·äï/·àΩ·äï ·ã®·âµ ·â≥·ã´·àà·àÖ/·ã´·àà·àΩ?" },
            { id: 17, cat: "Future", q: "·àç·åÖ ·ã®·àò·ãç·àà·ãµ ·çç·àã·åé·âµ ·ä†·àà·àÖ/·àΩ? ·àà·àù·äï?" },
            { id: 18, cat: "Future", q: "·àµ·ä¨·âµ ·àã·äï·â∞/·â∫ ·âµ·à≠·åâ·àô ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 19, cat: "Future", q: "·â†·àµ·à´ ·ä•·äì ·â†·â§·â∞·à∞·â• ·àò·ä´·ä®·àç ·ã´·àà·ãç ·àö·ãõ·äï ·àù·äï ·ã´·àÖ·àç ·ä†·àµ·çà·àã·åä ·äê·ãç?" },
            { id: 20, cat: "Future", q: "·àà·çç·âÖ·à≠ ·ãà·ã≠·àù ·àà·àµ·à´ ·àµ·âµ·àç/·ã≠ ·ã®·àò·äñ·à™·ã´ ·â¶·â≥·àÖ·äï/·àΩ·äï ·âµ·âÄ·ã≠·à´·àà·àÖ/·à™·ã´·àà·àΩ?" },
            { id: 21, cat: "Money", q: "·åà·äï·ãò·â• ·ä†·å†·âÉ·âÄ·àù·àÖ/·àΩ ·ä•·äï·ã¥·âµ ·äê·ãç? ·âÜ·å£·â¢·ç£ ·ä†·ãç·å™ ·ãà·ã≠·àµ ·ä¢·äï·â®·àµ·â∞·à≠?" },
            { id: 22, cat: "Money", q: "·ã®·åà·äï·ãò·â• ·ãã·àµ·âµ·äì ·àã·äï·â∞/·â∫ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 23, cat: "Money", q: "·å•·äï·ã∂·âΩ ·ã®·åà·äï·ãò·â• ·ä†·âÖ·àõ·â∏·ãç·äï ·àõ·å£·àò·à≠ ·ä†·àà·â£·â∏·ãç ·â•·àà·àÖ/·àΩ ·â≥·àù·äì·àà·àÖ/·äö·ã´·àà·àΩ?" },
            { id: 24, cat: "Money", q: "·ã®·çç·âÖ·à≠ ·åì·ã∞·äõ ·àµ·âµ·àò·à≠·å•/·å™ ·ã®·åà·äï·ãò·â• ·å•·äï·ä´·à¨·ãç ·àù·äï ·ã´·àÖ·àç ·ä†·àµ·çà·àã·åä ·äê·ãç?" },
            { id: 25, cat: "Money", q: "·ã´·àà·àù·äï·àù ·å∏·å∏·âµ ·åà·äï·ãò·â•·àÖ·äï/·àΩ·äï ·ã®·àù·â≥·ãà·å£·â†·âµ/·å™·â†·âµ ·ä†·äï·ãµ ·äê·åà·à≠ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 26, cat: "Values", q: "·â†·àÖ·ã≠·ãà·âµ·àÖ/·àΩ ·âµ·àç·âÅ·äï ·â¶·â≥ ·ã®·àù·âµ·à∞·å£·â∏·ãç/·å™·ã´·â∏·ãç 3 ·ä•·à¥·â∂·âΩ ·àù·äï·ãµ·äï ·äì·â∏·ãç?" },
            { id: 27, cat: "Values", q: "·àÉ·ã≠·àõ·äñ·âµ ·ãà·ã≠·àù ·àò·äï·çà·à≥·ãä·äê·âµ ·â†·àÖ·ã≠·ãà·âµ·àÖ/·àΩ ·ãç·àµ·å• ·àù·äï ·ã´·àÖ·àç ·â¶·â≥ ·ä†·àà·ãç?" },
            { id: 28, cat: "Values", q: "·ä®·äã·àã·àÖ/·àΩ ·àù·äï ·ä†·ã≠·äê·âµ ·ä†·àª·à´ ·å•·àà·àÖ/·àΩ ·àõ·àà·çç ·âµ·çà·àç·åã·àà·àÖ/·åä·ã´·àà·àΩ?" },
            { id: 29, cat: "Values", q: "·àµ·â≥·ãµ·åç/·åä ·â£·àÖ·à™·àÖ·äï/·àΩ·äï ·â†·àò·âÖ·à®·åΩ ·à®·åà·ãµ ·âµ·àç·âÅ·äï ·â∞·åΩ·ãï·äñ ·ã´·à≥·ã∞·à®·ãç ·àõ·äï ·äê·ãç?" },
            { id: 30, cat: "Values", q: "·àã·äï·â∞/·â∫ ·â≥·àõ·äù·äê·âµ ·àõ·àà·âµ ·àù·äï ·àõ·àà·âµ ·äê·ãç?" },
            { id: 31, cat: "Fun", q: "·ã®·àù·â≥·àç·àò·ãç/·àö·ãç ·ã®·åâ·ãû ·àò·ãù·äì·äõ ·ã®·âµ ·äê·ãç?" },
            { id: 32, cat: "Fun", q: "·â§·âµ ·àò·ãã·àç ·ã≠·àª·àç·àÉ·àç/·àª·àç ·ãà·ã≠·àµ ·ãç·å™ ·ãà·å•·â∂ ·ä†·ã≥·ã≤·àµ ·äê·åà·àÆ·âΩ·äï ·àò·àû·ä®·à≠?" },
            { id: 33, cat: "Fun", q: "·àù·äï ·ä†·ã≠·äê·âµ ·àÖ·ã≠·ãà·âµ ·â¢·äñ·à≠·àÖ/·àΩ ·äê·ãç ·àô·àâ (Fulfilled) ·ä•·äï·ã∞·àÜ·äï·ä≠/·àΩ ·ã®·àö·à∞·àõ·àÖ/·àΩ?" },
            { id: 34, cat: "Fun", q: "·ä´·àà·çà ·àÖ·ã≠·ãà·âµ·àÖ/·àΩ ·ä†·äï·ãµ ·äê·åà·à≠ ·àò·âÄ·ã®·à≠ ·â•·âµ·âΩ·àç/·ã≠ ·âµ·âÄ·ã≠·à≠/·à™ ·äê·â†·à≠?" },
            { id: 35, cat: "Fun", q: "·ä®·àù·äï·àù ·â†·àã·ã≠ ·ã®·àö·ã´·àµ·âÖ·àÖ/·àΩ ·äê·åà·à≠ ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 36, cat: "Intimacy", q: "·àà·àù·âµ·ãà·ã≥·â∏·ãç ·à∞·ãé·âΩ ·çç·âÖ·à≠·àÖ·äï/·àΩ·äï ·ä•·äï·ã¥·âµ ·äê·ãç ·ã®·àù·âµ·åà·àç·å∏·ãç/·å™·ãç?" },
            { id: 37, cat: "Intimacy", q: "·ã®·çç·âÖ·à≠ ·ä†·åã·à≠ ·â†·àÖ·ã≠·ãà·âµ·àÖ/·àΩ ·ãç·àµ·å• ·àù·äï ·ä†·ã≠·äê·âµ ·àö·äì ·àä·äñ·à®·ãç ·ã≠·åà·â£·àç?" },
            { id: 38, cat: "Intimacy", q: "·â†·ä†·äï·ãµ ·åç·äï·äô·äê·âµ ·ãç·àµ·å• ·ä≠·â•·à≠ ·àõ·àà·âµ ·àã·äï·â∞/·â∫ ·âµ·à≠·åâ·àô ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 39, cat: "Intimacy", q: "·ä†·â•·àÆ ·àõ·ã∞·åç ·ã®·àö·àà·ãç ·âÉ·àç ·àã·äï·â∞/·â∫ ·âµ·à≠·åâ·àô ·àù·äï·ãµ·äï ·äê·ãç?" },
            { id: 40, cat: "Intimacy", q: "·â†·àµ·â∞·à≠·åÖ·äì·àÖ/·àΩ ·åé·äï·àÖ/·àΩ ·ä•·äï·ã≤·àÜ·äï ·ã®·àù·âµ·çà·àç·åà·ãç/·åä·ãç ·àù·äï ·ä†·ã≠·äê·âµ ·ä†·åã·à≠ ·äê·ãç?" }
        ];

        /* ================= HAPTICS (Mobile Vibration) ================= */
        function haptic(type = "light") {
            if (!navigator.vibrate) return;
            const patterns = {
                light: 10,
                medium: 25,
                heavy: [30, 40, 30] // Success vibe
            };
            navigator.vibrate(patterns[type]);
        }

        /* ================= RENDER GRID ================= */
        const gridEl = document.getElementById("grid");

        function renderGrid() {
            const frag = document.createDocumentFragment();
            gridEl.innerHTML = "";
            
            db.forEach((item, index) => {
                const el = document.createElement("div");
                el.className = "card " + (appState.usedIds.includes(item.id) ? "used" : "");
                el.textContent = item.id;
                
                // Staggered entrance animation
                el.style.animationDelay = `${index * 30}ms`;
                
                el.onclick = () => {
                    if (!appState.isSpinning) openModal(item.id);
                };
                frag.appendChild(el);
            });
            gridEl.appendChild(frag);
            updateProgress();
        }

        /* ================= SMART RANDOM (Avoids repeats) ================= */
        function getSmartRandom(available) {
            // Try to avoid the last 3 selected numbers if possible
            const recent = appState.usedIds.slice(-3);
            const filtered = available.filter(a => !recent.includes(a.id));
            const pool = filtered.length > 0 ? filtered : available;
            return pool[Math.floor(Math.random() * pool.length)];
        }

        /* ================= SPIN ROULETTE ================= */
        document.getElementById("spinBtn").onclick = () => {
            const available = db.filter(d => !appState.usedIds.includes(d.id));
            if (available.length === 0) return alert("üéâ All questions answered! Reset to play again.");

            appState.isSpinning = true;
            const btn = document.getElementById("spinBtn");
            btn.classList.add("spinning");

            let counter = 0;
            let speed = 50;
            let lastHighlight = null;
            const jumps = 20;

            function step() {
                // Clear previous
                if (lastHighlight) {
                    const prevEl = gridEl.children[lastHighlight.id - 1];
                    if (prevEl) prevEl.classList.remove("highlight");
                }

                // Pick smart random
                const randomItem = getSmartRandom(available);
                const el = gridEl.children[randomItem.id - 1];
                
                // Highlight
                el.classList.add("highlight");
                el.scrollIntoView({ behavior: "smooth", block: "center" });
                lastHighlight = randomItem;

                counter++;

                if (counter < jumps) {
                    // Slow down curve
                    if (counter > jumps - 5) speed += 60;
                    setTimeout(step, speed);
                } else {
                    // Finish
                    setTimeout(() => {
                        // Keep highlight on selected one? No, remove it and open modal
                        el.classList.remove("highlight");
                        openModal(randomItem.id);
                        
                        btn.classList.remove("spinning");
                        appState.isSpinning = false;
                        haptic("medium");
                    }, 400);
                }
            }
            step();
        };

        /* ================= MODAL LOGIC ================= */
        const overlay = document.getElementById("overlay");

        function openModal(id) {
            appState.currentId = id;
            const data = db.find(x => x.id === id);
            
            // Set Content
            const catEl = document.getElementById("mCategory");
            catEl.textContent = data.cat;
            // Dynamic category color
            catEl.style.background = categoryColors[data.cat] + "30"; // 30 = low opacity
            catEl.style.color = categoryColors[data.cat];
            catEl.style.borderColor = categoryColors[data.cat] + "50";

            document.getElementById("mNumber").textContent = "QUESTION " + id;
            document.getElementById("mText").textContent = data.q;
            
            overlay.classList.add("active");
            haptic("light");
        }

        // Close Logic
        function closeModal() {
            overlay.classList.remove("active");
        }
        document.getElementById("closeBtn").onclick = closeModal;
        overlay.onclick = (e) => {
            if(e.target === overlay) closeModal();
        };

        /* ================= MARK AS DONE ================= */
        document.getElementById("doneBtn").onclick = () => {
            const id = appState.currentId;
            if (id && !appState.usedIds.includes(id)) {
                appState.usedIds.push(id);
                localStorage.setItem("dash_used_v3", JSON.stringify(appState.usedIds));
                
                renderGrid(); // Refresh UI
                triggerConfetti(); // Celebration
                checkCompletion();
            }
            closeModal();
        };

        /* ================= COMPLETION CHECK ================= */
        function checkCompletion() {
            if (appState.usedIds.length === appState.total) {
                triggerMegaConfetti();
                setTimeout(() => alert("üéâ You completed Connection Lab!"), 500);
            }
        }

        /* ================= CONFETTI ================= */
        function triggerConfetti(count = 30) {
            const colors = ['#e11d48', '#fb7185', '#10b981', '#ffffff', '#ffd700'];
            for (let i = 0; i < count; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                c.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(c);
                
                setTimeout(() => c.remove(), 3000);
            }
        }
        
        function triggerMegaConfetti() {
            triggerConfetti(120);
        }

        /* ================= RESET BUTTON (Double Tap) ================= */
        const resetBtn = document.getElementById("resetBtn");
        let resetTimeout;

        resetBtn.onclick = () => {
            if (resetBtn.classList.contains("confirming")) {
                // Confirmed
                appState.usedIds = [];
                localStorage.removeItem("dash_used_v3");
                renderGrid();
                
                resetBtn.classList.remove("confirming");
                resetBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> Start Over';
                haptic("heavy");
                
            } else {
                // First Tap
                resetBtn.classList.add("confirming");
                resetBtn.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> Tap again to confirm';
                
                clearTimeout(resetTimeout);
                resetTimeout = setTimeout(() => {
                    resetBtn.classList.remove("confirming");
                    resetBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> Start Over';
                }, 3000);
            }
        };

        /* ================= PROGRESS ================= */
        function updateProgress() {
            document.getElementById("progressText").textContent = 
                `${appState.usedIds.length}/${appState.total}`;
        }

        /* ================= INIT ================= */
        renderGrid();

    </script>
</body>
</html>
