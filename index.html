<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#4c0519">
    
    <!-- SOCIAL SHARE PREVIEW (Telegram/WhatsApp) -->
    <meta property="og:title" content="Connection Lab â¤ï¸">
    <meta property="og:description" content="50 Deep Questions to strengthen our bond. Let's play!">
    <meta property="og:image" content="https://ui-avatars.com/api/?name=â¤ï¸&background=e11d48&color=fff&size=512&font-size=0.5">
    <meta property="og:url" content="https://solomon19.github.io/game.html">
    <meta property="og:type" content="website">

    <!-- FAVICON -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’</text></svg>">

    <title>Connection Lab â¤ï¸</title>
    
    <!-- Premium Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Ethiopic:wght@300;500;700&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            /* ROMANTIC THEME PALETTE */
            --primary: #e11d48;    /* Rose Red */
            --secondary: #fb7185;  /* Soft Pink */
            --success: #10b981;    /* Green */
            --danger: #ef4444;     /* Red */
            --bg-dark: #4c0519;    /* Deep Wine */
            
            --glass-surface: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.7);
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        
        body {
            margin: 0;
            font-family: 'Outfit', 'Noto Sans Ethiopic', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: env(safe-area-inset-bottom);
            overflow-x: hidden;
        }

        /* --- Animated Background --- */
        .ambient-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, #2e020e, #4c0519, #881337, #be123c);
            background-size: 400% 400%;
            animation: gradientBG 20s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Toast Notification --- */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            width: 90%;
            max-width: 400px;
            pointer-events: none;
        }

        .toast {
            background: rgba(255, 255, 255, 0.95);
            color: #4c0519;
            padding: 12px 20px;
            border-radius: 50px;
            margin-bottom: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            font-weight: 700;
            font-size: 0.9rem;
            text-align: center;
            opacity: 0;
            transform: translateY(-20px) scale(0.9);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .toast.show { opacity: 1; transform: translateY(0) scale(1); }

        /* --- Header --- */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(46, 2, 14, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 15px 24px;
            padding-top: max(15px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            font-size: 1.2rem;
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-placeholder {
            width: 40px; height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: white;
            box-shadow: 0 4px 15px rgba(225, 29, 72, 0.5);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .progress-pill {
            background: rgba(255,255,255,0.1);
            padding: 6px 14px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            border: 1px solid var(--glass-border);
        }

        /* --- Controls --- */
        .controls-area { padding: 25px 20px; text-align: center; }

        .btn-spin {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(225, 29, 72, 0.5);
            display: inline-flex; align-items: center; gap: 12px;
            transition: transform 0.2s;
            position: relative; overflow: hidden;
        }

        .btn-spin:active { transform: scale(0.96); }
        
        /* Shine Effect */
        .btn-spin::after {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.4), transparent);
            transform: skewX(-20deg);
            animation: shine 4s infinite;
        }
        @keyframes shine { 0% { left: -100%; } 20% { left: 200%; } 100% { left: 200%; } }

        .btn-spin.spinning i { animation: spinIcon 0.8s linear infinite; }
        @keyframes spinIcon { 100% { transform: rotate(360deg); } }

        /* --- Grid --- */
        .container { max-width: 600px; margin: 0 auto; padding: 0 20px 60px 20px; }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 40px;
        }

        .card {
            aspect-ratio: 1;
            background: var(--glass-surface);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.2rem; font-weight: 700; color: white;
            cursor: pointer; position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            opacity: 0; transform: translateY(20px);
            animation: cardEntrance 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }

        @keyframes cardEntrance { to { opacity: 1; transform: translateY(0); } }

        .card:active { transform: scale(0.9) !important; }

        .card.highlight {
            background: white; color: var(--primary);
            box-shadow: 0 0 25px rgba(251, 113, 133, 0.8);
            transform: scale(1.15); z-index: 10; border-color: white;
        }

        .card.used {
            background: rgba(0,0,0,0.25); border-color: transparent;
            color: rgba(255,255,255,0.2); box-shadow: none;
        }

        /* --- Reset Button --- */
        .btn-reset {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-muted);
            border: 1px solid var(--glass-border);
            padding: 18px; width: 100%; border-radius: 18px;
            font-size: 1rem; font-weight: 600;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: all 0.3s;
        }

        .btn-reset.confirming {
            background: var(--danger); color: white;
            border-color: var(--danger); animation: shake 0.4s ease-in-out;
        }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* --- Modal --- */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            z-index: 100; opacity: 0; visibility: hidden;
            transition: opacity 0.3s; display: flex; align-items: flex-end; justify-content: center;
        }
        
        /* Center modal on desktop, bottom on mobile */
        @media(min-width: 600px) { .modal-overlay { align-items: center; } }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .sheet {
            background: linear-gradient(to bottom, #4c0519, #2e020e);
            border-top: 1px solid rgba(255,255,255,0.2);
            border-radius: 30px 30px 0 0;
            padding: 30px 24px;
            padding-bottom: max(30px, env(safe-area-inset-bottom));
            transform: translateY(110%);
            transition: transform 0.5s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 101; width: 100%; max-width: 600px;
            box-shadow: 0 -10px 50px rgba(0,0,0,0.5);
        }
        
        @media(min-width: 600px) { .sheet { border-radius: 30px; } }

        .modal-overlay.active .sheet { transform: translateY(0); }

        .category-badge {
            display: inline-block;
            background: rgba(251, 113, 133, 0.15);
            color: #fca5a5;
            font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
            padding: 8px 16px; border-radius: 10px; margin-bottom: 20px;
            border: 1px solid rgba(251, 113, 133, 0.3);
        }

        .q-text {
            font-size: 1.5rem; line-height: 1.5; font-weight: 600;
            color: white; margin-bottom: 40px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .modal-actions { display: grid; grid-template-columns: 1fr 4fr; gap: 12px; }

        .btn-share {
            background: rgba(255,255,255,0.1); color: white;
            border: 1px solid rgba(255,255,255,0.2); border-radius: 18px;
            font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white; border: none; padding: 18px; border-radius: 18px;
            font-size: 1.1rem; font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 15px rgba(225, 29, 72, 0.3);
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        
        .btn-close-text {
            background: transparent; border: none; color: var(--text-muted);
            margin-top: 15px; width: 100%; padding: 10px; font-size: 0.95rem; cursor: pointer;
        }

        /* --- Victory Screen --- */
        .victory-modal {
            text-align: center;
            display: none;
        }
        .victory-modal.show { display: block; }
        .victory-icon { font-size: 4rem; margin-bottom: 20px; animation: bounce 2s infinite; }
        
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-20px);} 60% {transform: translateY(-10px);} }

        /* --- Confetti --- */
        .confetti {
            position: fixed; width: 8px; height: 8px; top: -10px; z-index: 200; pointer-events: none;
            animation: fall linear forwards;
        }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }

    </style>
</head>
<body>

    <div class="ambient-bg"></div>
    <div id="toastContainer" class="toast-container"></div>

    <!-- Header -->
    <header class="app-header">
        <div class="brand">
            <div class="logo-placeholder"><i class="fa-solid fa-heart"></i></div>
            <span>Connection Lab</span>
        </div>
        <div class="progress-pill">
            <span id="progressText">0/50</span>
        </div>
    </header>

    <!-- Controls -->
    <div class="controls-area">
        <button class="btn-spin" id="spinBtn">
            <i class="fa-solid fa-arrows-rotate"></i> Spin Random
        </button>
    </div>

    <!-- Main Grid -->
    <div class="container">
        <div class="grid" id="grid"></div>
        
        <button id="resetBtn" class="btn-reset">
            <i class="fa-solid fa-rotate-right"></i> Start Over
        </button>
    </div>

    <!-- Question Modal -->
    <div class="modal-overlay" id="overlay">
        <div class="sheet" id="questionSheet">
            <!-- Normal Question Content -->
            <div id="qContent">
                <div style="text-align: center;">
                    <div style="font-size: 0.9rem; color: #fda4af; margin-bottom: 12px; font-weight: 600; letter-spacing: 1px;" id="mNumber">#</div>
                    <div class="category-badge" id="mCategory">Topic</div>
                    <div class="q-text" id="mText">...</div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn-share" id="shareBtn" onclick="shareQuestion()">
                        <i class="fa-solid fa-share-nodes"></i>
                    </button>
                    <button class="btn-primary" id="doneBtn">
                        <i class="fa-solid fa-check"></i> Mark as Done
                    </button>
                </div>
                <button class="btn-close-text" id="closeBtn">Close</button>
            </div>

            <!-- Victory Content (Hidden by default) -->
            <div id="victoryContent" class="victory-modal">
                <div class="victory-icon">ğŸ‘‘</div>
                <div class="q-text">You completed all 50 questions!</div>
                <p style="color: rgba(255,255,255,0.7); margin-bottom: 30px;">You are now closer than ever.</p>
                <button class="btn-primary" onclick="resetGameForce()">
                    <i class="fa-solid fa-rotate-right"></i> Play Again
                </button>
            </div>
        </div>
    </div>

    <script>
        /* ================= AUDIO ENGINE (Synthesized) ================= */
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'tick') {
                // Roulette Tick (Short high blip)
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(300, now + 0.05);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
                osc.start(now);
                osc.stop(now + 0.05);
            } 
            else if (type === 'pop') {
                // Modal Open (Pleasant Pop)
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            }
            else if (type === 'success') {
                // Success Chord (Major Triad)
                [440, 554, 659].forEach((freq, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    o.type = 'sine';
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.05, now + (i*0.05));
                    g.gain.exponentialRampToValueAtTime(0.001, now + 0.5 + (i*0.05));
                    o.start(now + (i*0.05));
                    o.stop(now + 0.6);
                });
            }
        }

        /* ================= STATE ================= */
        const appState = {
            usedIds: JSON.parse(localStorage.getItem('dash_used_v3')) || [],
            currentId: null,
            isSpinning: false,
            total: 50
        };

        const categoryColors = {
            "Personality": "#fb7185", "Love": "#f43f5e", "Depth": "#e11d48",
            "Future": "#be123c", "Money": "#10b981", "Values": "#6366f1",
            "Fun": "#f59e0b", "Intimacy": "#ec4899"
        };

        const db = [
            { id: 1, cat: "Personality", q: "á‰ áˆ…á‹­á‹ˆá‰µáˆ½ á‰ áŒ£áˆ á‹°áˆµá‰°áŠ› á‹¨áˆšá‹«á‹°áˆ­áŒáˆ½ áŠáŒˆáˆ­ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 2, cat: "Personality", q: "á‰ áˆ«áˆµáˆ½ á‰ áŒ£áˆ á‹¨áˆá‰µáŠ®áˆªá‰ á‰µ áŠáŒˆáˆ­ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 3, cat: "Personality", q: "áˆ°á‹á‰½ áˆµáˆˆ áŠ áŠ•á‰º áŠ á‰¥á‹›áŠ›á‹ áŒŠá‹œ á‰ á‰°áˆ³áˆ³á‰° áˆ˜áŠ•áŒˆá‹µ á‹¨áˆšáˆ¨á‹±á‰µ áŠáŒˆáˆ­ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 4, cat: "Personality", q: "áˆ…á‹­á‹ˆá‰µ áˆá‰³áŠ á‰ áˆšáˆ†áŠ•á‰ á‰µ áŒŠá‹œ á‹ˆá‹°áŠá‰µ áŠ¥áŠ•á‹µá‰µá‰€áŒ¥á‹­ á‹¨áˆšá‹«á‰ áˆ¨á‰³á‰³áˆ½ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 5, cat: "Personality", q: "á‹áˆ³áŠ” áŠ áˆ°áŒ£áŒ¥áˆ½ áŠ¥áŠ•á‹´á‰µ áŠá‹? á‰ áˆµáˆœá‰µ á‹ˆá‹­áˆµ á‰ áˆáŠ­áŠ•á‹«á‰µ?" },
            { id: 6, cat: "Love", q: "áŒ¤áŠ“áˆ› áŒáŠ•áŠ™áŠá‰µ á‰ áŠ áŠ•á‰º áŠ¥á‹­á‰³ áˆáŠ• á‹­áˆ˜áˆµáˆ‹áˆ?" },
            { id: 7, cat: "Love", q: "á‰ áŒ£áˆ áŠ¥áŠ•á‹°á‰°á‹ˆá‹°á‹µáˆ½ á‹¨áˆšáˆ°áˆ›áˆ½ á‰ áˆáŠ• áŠ á‹­áŠá‰µ áˆáŠ”á‰³ áŠá‹?" },
            { id: 8, cat: "Love", q: "á‰ áŠ áŠ•á‹µ áŒáŠ•áŠ™áŠá‰µ á‹áˆµáŒ¥ á‰ ááŒ¹áˆ á‹¨áˆ›á‹­á‰³áˆˆá áŠáŒˆáˆ­ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 9, cat: "Love", q: "áŠ áˆˆáˆ˜áŒá‰£á‰£á‰¶á‰½ áˆ²áˆáŒ áˆ© áŠ á‰¥á‹›áŠ›á‹áŠ• áŒŠá‹œ áŠ¥áŠ•á‹´á‰µ áŠá‹ á‹¨áˆá‰³áˆµá‰°áŠ“áŒáŒ‚á‹?" },
            { id: 10, cat: "Love", q: "áá‰…áˆ­ á‰ áŒŠá‹œ áˆ‚á‹°á‰µ áŠ¥á‹«á‹°áŒˆ á‹¨áˆšáˆ˜áŒ£ á‹­áˆ˜áˆµáˆáˆ»áˆ á‹ˆá‹­áˆµ á‰ áŠ áŠ•á‹´ á‹¨áˆšáˆáŒ áˆ­?" },
            { id: 11, cat: "Depth", q: "áˆ…á‹­á‹ˆá‰µ á‰ áŠ áˆµá‰¸áŒ‹áˆª áˆ˜áŠ•áŒˆá‹µ á‹«áˆµá‰°áˆ›áˆ¨áˆ½ á‰µáˆá‰ á‰µáˆáˆ…áˆ­á‰µ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 12, cat: "Depth", q: "áˆ²áŒ¨áŠ•á‰…áˆ½ áˆ«áˆµáˆ½áŠ• áˆˆáˆ›áˆ¨áŒ‹áŒ‹á‰µ áˆáŠ• á‰³á‹°áˆ­áŒŠá‹«áˆˆáˆ½?" },
            { id: 13, cat: "Depth", q: "áŠ áŠ•á‹µ áˆ°á‹ á‰ áˆµáˆœá‰µáˆ½ áˆ‹á‹­ áŒ‰á‹³á‰µ á‰¢á‹«á‹°áˆ­áˆµá‰¥áˆ½ áˆáˆ‹áˆ½áˆ½ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 14, cat: "Depth", q: "á‰ á‰€áˆ‹áˆ‰ á‹­á‰…áˆ­ á‰µá‹«áˆˆáˆ½ á‹ˆá‹­áˆµ áŒŠá‹œ á‹«áˆµáˆáˆáŒáˆ»áˆ?" },
            { id: 15, cat: "Depth", q: "á‰ á‰µáˆá‰…áŠá‰µ á‹¨áˆá‰µáˆáˆªá‹ á‹¨áˆµáˆœá‰µ áˆµáŒ‹á‰µ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 16, cat: "Future", q: "á‰ 5-10 á‹“áˆ˜á‰³á‰µ á‹áˆµáŒ¥ áˆ«áˆµáˆ½áŠ• á‹¨á‰µ á‰³á‹«áˆˆáˆ½?" },
            { id: 17, cat: "Future", q: "áˆáŒ… á‹¨áˆ˜á‹áˆˆá‹µ ááˆ‹áŒá‰µ áŠ áˆˆáˆ½? áˆˆáˆáŠ•?" },
            { id: 18, cat: "Future", q: "áˆµáŠ¬á‰µ áˆ‹áŠ•á‰º á‰µáˆ­áŒ‰áˆ™ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 19, cat: "Future", q: "á‰ áˆµáˆ« áŠ¥áŠ“ á‰ á‰¤á‰°áˆ°á‰¥ áˆ˜áŠ«áŠ¨áˆ á‹«áˆˆá‹ áˆšá‹›áŠ• áˆáŠ• á‹«áˆ…áˆ áŠ áˆµáˆáˆ‹áŒŠ áŠá‹?" },
            { id: 20, cat: "Future", q: "áˆˆáá‰…áˆ­ á‹ˆá‹­áˆ áˆˆáˆµáˆ« áˆµá‰µá‹­ á‹¨áˆ˜áŠ–áˆªá‹« á‰¦á‰³áˆ½áŠ• á‰µá‰€á‹­áˆªá‹«áˆˆáˆ½?" },
            { id: 21, cat: "Money", q: "áŒˆáŠ•á‹˜á‰¥ áŠ áŒ á‰ƒá‰€áˆáˆ½ áŠ¥áŠ•á‹´á‰µ áŠá‹? á‰†áŒ£á‰¢á£ áŠ á‹áŒª á‹ˆá‹­áˆµ áŠ¢áŠ•á‰¨áˆµá‰°áˆ­?" },
            { id: 22, cat: "Money", q: "á‹¨áŒˆáŠ•á‹˜á‰¥ á‹‹áˆµá‰µáŠ“ áˆ‹áŠ•á‰º áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 23, cat: "Money", q: "áŒ¥áŠ•á‹¶á‰½ á‹¨áŒˆáŠ•á‹˜á‰¥ áŠ á‰…áˆ›á‰¸á‹áŠ• áˆ›áŒ£áˆ˜áˆ­ áŠ áˆˆá‰£á‰¸á‹ á‰¥áˆˆáˆ½ á‰³áˆáŠšá‹«áˆˆáˆ½?" },
            { id: 24, cat: "Money", q: "á‹¨áá‰…áˆ­ áŒ“á‹°áŠ› áˆµá‰µáˆ˜áˆ­áŒª á‹¨áŒˆáŠ•á‹˜á‰¥ áŒ¥áŠ•áŠ«áˆ¬á‹ áˆáŠ• á‹«áˆ…áˆ áŠ áˆµáˆáˆ‹áŒŠ áŠá‹?" },
            { id: 25, cat: "Money", q: "á‹«áˆˆáˆáŠ•áˆ áŒ¸áŒ¸á‰µ áŒˆáŠ•á‹˜á‰¥áˆ½áŠ• á‹¨áˆá‰³á‹ˆáŒªá‰ á‰µ áŠ áŠ•á‹µ áŠáŒˆáˆ­ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 26, cat: "Values", q: "á‰ áˆ…á‹­á‹ˆá‰µáˆ½ á‰µáˆá‰áŠ• á‰¦á‰³ á‹¨áˆá‰µáˆ°áŒªá‹«á‰¸á‹ 3 áŠ¥áˆ´á‰¶á‰½ áˆáŠ•á‹µáŠ• áŠ“á‰¸á‹?" },
            { id: 27, cat: "Values", q: "áˆƒá‹­áˆ›áŠ–á‰µ á‹ˆá‹­áˆ áˆ˜áŠ•áˆáˆ³á‹ŠáŠá‰µ á‰ áˆ…á‹­á‹ˆá‰µáˆ½ á‹áˆµáŒ¥ áˆáŠ• á‹«áˆ…áˆ á‰¦á‰³ áŠ áˆˆá‹?" },
            { id: 28, cat: "Values", q: "áŠ¨áŠ‹áˆ‹áˆ½ áˆáŠ• áŠ á‹­áŠá‰µ áŠ áˆ»áˆ« áŒ¥áˆˆáˆ½ áˆ›áˆˆá á‰µáˆáˆáŒŠá‹«áˆˆáˆ½?" },
            { id: 29, cat: "Values", q: "áˆµá‰³á‹µáŒŠ á‰£áˆ…áˆªáˆ½áŠ• á‰ áˆ˜á‰…áˆ¨áŒ½ áˆ¨áŒˆá‹µ á‰µáˆá‰áŠ• á‰°áŒ½á‹•áŠ– á‹«áˆ³á‹°áˆ¨á‹ áˆ›áŠ• áŠá‹?" },
            { id: 30, cat: "Values", q: "áˆ‹áŠ•á‰º á‰³áˆ›áŠáŠá‰µ áˆ›áˆˆá‰µ áˆáŠ• áˆ›áˆˆá‰µ áŠá‹?" },
            { id: 31, cat: "Fun", q: "á‹¨áˆá‰³áˆáˆšá‹ á‹¨áŒ‰á‹ áˆ˜á‹áŠ“áŠ› á‹¨á‰µ áŠá‹?" },
            { id: 32, cat: "Fun", q: "á‰¤á‰µ áˆ˜á‹‹áˆ á‹­áˆ»áˆáˆ»áˆ á‹ˆá‹­áˆµ á‹áŒª á‹ˆáŒ¥á‰¶ áŠ á‹³á‹²áˆµ áŠáŒˆáˆ®á‰½áŠ• áˆ˜áˆáŠ¨áˆ­?" },
            { id: 33, cat: "Fun", q: "áˆáŠ• áŠ á‹­áŠá‰µ áˆ…á‹­á‹ˆá‰µ á‰¢áŠ–áˆ­áˆ½ áŠá‹ áˆ™áˆ‰ (Fulfilled) áŠ¥áŠ•á‹°áˆ†áŠ•áˆ½ á‹¨áˆšáˆ°áˆ›áˆ½?" },
            { id: 34, cat: "Fun", q: "áŠ«áˆˆáˆ áˆ…á‹­á‹ˆá‰µáˆ½ áŠ áŠ•á‹µ áŠáŒˆáˆ­ áˆ˜á‰€á‹¨áˆ­ á‰¥á‰µá‰½á‹ª á‰µá‰€á‹­áˆª áŠá‰ áˆ­?" },
            { id: 35, cat: "Fun", q: "áŠ¨áˆáŠ•áˆ á‰ áˆ‹á‹­ á‹¨áˆšá‹«áˆµá‰…áˆ½ áŠáŒˆáˆ­ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 36, cat: "Intimacy", q: "áˆˆáˆá‰µá‹ˆá‹³á‰¸á‹ áˆ°á‹á‰½ áá‰…áˆ­áˆ½áŠ• áŠ¥áŠ•á‹´á‰µ áŠá‹ á‹¨áˆá‰µáŒˆáˆáŒªá‹?" },
            { id: 37, cat: "Intimacy", q: "á‹¨áá‰…áˆ­ áŠ áŒ‹áˆ­ á‰ áˆ…á‹­á‹ˆá‰µáˆ½ á‹áˆµáŒ¥ áˆáŠ• áŠ á‹­áŠá‰µ áˆšáŠ“ áˆŠáŠ–áˆ¨á‹ á‹­áŒˆá‰£áˆ?" },
            { id: 38, cat: "Intimacy", q: "á‰ áŠ áŠ•á‹µ áŒáŠ•áŠ™áŠá‰µ á‹áˆµáŒ¥ áŠ­á‰¥áˆ­ áˆ›áˆˆá‰µ áˆ‹áŠ•á‰º á‰µáˆ­áŒ‰áˆ™ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 39, cat: "Intimacy", q: "áŠ á‰¥áˆ® áˆ›á‹°áŒ á‹¨áˆšáˆˆá‹ á‰ƒáˆ áˆ‹áŠ•á‰º á‰µáˆ­áŒ‰áˆ™ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 40, cat: "Intimacy", q: "á‰ áˆµá‰°áˆ­áŒ…áŠ“áˆ½ áŒáŠ•áˆ½ áŠ¥áŠ•á‹²áˆ†áŠ• á‹¨áˆá‰µáˆáˆáŒŠá‹ áˆáŠ• áŠ á‹­áŠá‰µ áŠ áŒ‹áˆ­ áŠá‹?" },
            { id: 41, cat: "Fun", q: "áŒ á‹‹á‰µ áˆµá‰µáŠáˆº áˆ˜áŒ€áˆ˜áˆªá‹« á‹¨áˆá‰³á‹°áˆ­áŒŠá‹ áŠáŒˆáˆ­ áˆáŠ•á‹µáŠ• áŠá‹?" },
            { id: 42, cat: "Depth", q: "á‰¥á‰»áˆ½áŠ• áˆ˜áˆ†áŠ• á‹«áˆµáˆáˆ«áˆ»áˆ á‹ˆá‹­áˆµ á‹«áˆµá‹°áˆµá‰µáˆ»áˆ?" },
            { id: 43, cat: "Personality", q: "áˆáŒ…áŠá‰µáˆ½ áˆ‹á‹­ á‹¨áŠá‰ áˆ¨áˆ½ áˆ…áˆáˆ áˆáŠ• áŠá‰ áˆ­?" },
            { id: 44, cat: "Personality", q: "áˆ°á‹ á‰¢áˆ°á‹µá‰¥áˆ½ áˆ˜áˆáˆµ á‰µáˆ°áŒ«áˆˆáˆ½ á‹ˆá‹­áˆµ á‹áˆ á‰µá‹«áˆˆáˆ½?" },
            { id: 45, cat: "Love", q: "á‹ˆáŠ•á‹µáŠ• áˆáŒ… á‰ áá‰…áˆ­ áˆˆáˆ›á‹á‹°á‰… á‹¨áˆá‰µáŒ á‰€áˆšá‰ á‰µ á‹˜á‹´ áŠ áˆˆ?" },
            { id: 46, cat: "Values", q: "á‹áˆ¸á‰µ á‰°áŠ“áŒáˆ¨áˆ½ á‰³á‹á‰‚á‹«áˆˆáˆ½? áˆˆáˆáŠ•?" },
            { id: 47, cat: "Depth", q: "á‰ áˆ…á‹­á‹ˆá‰µáˆ½ á‹¨áˆšá‰†áŒ­áˆ½ áŠáŒˆáˆ­ áŠ áˆˆ?" },
            { id: 48, cat: "Future", q: "áŠ¥áˆ­áŒ…áŠ“ á‹«áˆµáˆáˆ«áˆ»áˆ?" },
            { id: 49, cat: "Fun", q: "áˆ¶áˆ»áˆ áˆšá‹²á‹« áˆ‹á‹­ á‹¨áˆá‰³áŒ áŠá‹áŠ• áŒŠá‹œ áˆ˜á‰€áŠáˆµ á‰µáˆáˆáŒŠá‹«áˆˆáˆ½?" },
            { id: 50, cat: "Intimacy", q: "á‹¨áˆ˜áŒ€áˆ˜áˆªá‹«á‹ á‹¨áá‰…áˆ­ áŒáŠ•áŠ™áŠá‰µáˆ½ áˆáŠ• áŠ áˆµá‰°áˆ›áˆ¨áˆ½?" }
        ];

        /* ================= TOAST ================= */
        function showToast(message, icon = "fa-info-circle") {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<i class="fa-solid ${icon}"></i> <span>${message}</span>`;
            container.appendChild(toast);
            requestAnimationFrame(() => toast.classList.add('show'));
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        /* ================= HAPTICS ================= */
        function haptic(type = "light") {
            if (!navigator.vibrate) return;
            const patterns = { light: 10, medium: 25, heavy: [30, 40, 30] };
            navigator.vibrate(patterns[type]);
        }

        /* ================= RENDER ================= */
        const gridEl = document.getElementById("grid");

        function renderGrid() {
            const frag = document.createDocumentFragment();
            gridEl.innerHTML = "";
            db.forEach((item, index) => {
                const el = document.createElement("div");
                el.className = "card " + (appState.usedIds.includes(item.id) ? "used" : "");
                el.textContent = item.id;
                el.style.animationDelay = `${index * 15}ms`;
                el.onclick = () => { if (!appState.isSpinning) openModal(item.id); };
                frag.appendChild(el);
            });
            gridEl.appendChild(frag);
            updateProgress();
        }

        /* ================= SPIN ROULETTE ================= */
        document.getElementById("spinBtn").onclick = () => {
            const available = db.filter(d => !appState.usedIds.includes(d.id));
            if (available.length === 0) return checkCompletion();

            appState.isSpinning = true;
            const btn = document.getElementById("spinBtn");
            btn.classList.add("spinning");

            let counter = 0;
            let speed = 20;
            let lastHighlight = null;
            const maxJumps = 25;

            function step() {
                if (lastHighlight) {
                    const prevEl = gridEl.children[lastHighlight.id - 1];
                    if (prevEl) prevEl.classList.remove("highlight");
                }

                const randomItem = available[Math.floor(Math.random() * available.length)];
                const el = gridEl.children[randomItem.id - 1];
                
                el.classList.add("highlight");
                el.scrollIntoView({ behavior: "smooth", block: "center" });
                lastHighlight = randomItem;
                
                playSound('tick'); // Sound Effect

                counter++;

                if (counter < maxJumps) {
                    speed = Math.floor(speed * 1.15); 
                    setTimeout(step, speed);
                } else {
                    setTimeout(() => {
                        el.classList.remove("highlight");
                        openModal(randomItem.id);
                        btn.classList.remove("spinning");
                        appState.isSpinning = false;
                        haptic("medium");
                    }, 500);
                }
            }
            step();
        };

        /* ================= MODAL ================= */
        const overlay = document.getElementById("overlay");
        const qContent = document.getElementById("qContent");
        const vContent = document.getElementById("victoryContent");

        function openModal(id) {
            appState.currentId = id;
            const data = db.find(x => x.id === id);
            
            // Ensure we are showing question, not victory
            qContent.style.display = "block";
            vContent.classList.remove("show");

            const catEl = document.getElementById("mCategory");
            catEl.textContent = data.cat;
            catEl.style.background = categoryColors[data.cat] + "30";
            catEl.style.color = categoryColors[data.cat];
            catEl.style.borderColor = categoryColors[data.cat] + "50";

            document.getElementById("mNumber").textContent = "QUESTION " + id;
            document.getElementById("mText").textContent = data.q;
            
            overlay.classList.add("active");
            haptic("light");
            playSound('pop');
        }

        function closeModal() { overlay.classList.remove("active"); }
        document.getElementById("closeBtn").onclick = closeModal;
        overlay.onclick = (e) => { if(e.target === overlay) closeModal(); };

        /* ================= SHARE ================= */
        function shareQuestion() {
            const data = db.find(x => x.id === appState.currentId);
            const text = `ğŸ”¥ Connection Lab #${data.id}\n\n"${data.q}"`;
            
            if (navigator.share) {
                navigator.share({ title: 'Connection Lab', text: text })
                    .catch(() => copyToClipboard(text));
            } else {
                copyToClipboard(text);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast("Copied to clipboard!", "fa-copy");
            });
        }

        /* ================= MARK DONE ================= */
        document.getElementById("doneBtn").onclick = () => {
            const id = appState.currentId;
            if (id && !appState.usedIds.includes(id)) {
                appState.usedIds.push(id);
                localStorage.setItem("dash_used_v3", JSON.stringify(appState.usedIds));
                
                renderGrid();
                triggerConfetti();
                playSound('success');
                
                if (appState.usedIds.length === appState.total) {
                    setTimeout(() => showVictory(), 500);
                }
            }
            closeModal();
        };

        function showVictory() {
            qContent.style.display = "none";
            vContent.classList.add("show");
            overlay.classList.add("active");
            triggerMegaConfetti();
            playSound('success');
        }

        /* ================= CONFETTI & PROGRESS ================= */
        function triggerConfetti(count = 30) {
            const colors = ['#e11d48', '#fb7185', '#10b981', '#ffffff', '#ffd700'];
            for (let i = 0; i < count; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                c.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(c);
                setTimeout(() => c.remove(), 3000);
            }
        }
        function triggerMegaConfetti() { triggerConfetti(120); }

        function updateProgress() {
            document.getElementById("progressText").textContent = 
                `${appState.usedIds.length}/${appState.total}`;
        }

        /* ================= RESET ================= */
        const resetBtn = document.getElementById("resetBtn");
        let resetTimeout;

        resetBtn.onclick = handleReset;
        
        function handleReset() {
            if (resetBtn.classList.contains("confirming")) {
                resetGameForce();
            } else {
                resetBtn.classList.add("confirming");
                resetBtn.innerHTML = '<i class="fa-solid fa-triangle-exclamation"></i> Tap again to confirm';
                clearTimeout(resetTimeout);
                resetTimeout = setTimeout(() => {
                    resetBtn.classList.remove("confirming");
                    resetBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> Start Over';
                }, 3000);
            }
        }

        function resetGameForce() {
            appState.usedIds = [];
            localStorage.removeItem("dash_used_v3");
            renderGrid();
            
            resetBtn.classList.remove("confirming");
            resetBtn.innerHTML = '<i class="fa-solid fa-rotate-right"></i> Start Over';
            showToast("Game Reset!", "fa-trash-can");
            haptic("heavy");
            closeModal();
        }

        /* ================= INIT ================= */
        renderGrid();

    </script>
</body>
</html>
